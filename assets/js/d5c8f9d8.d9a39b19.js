"use strict";(globalThis.webpackChunkdev_tips=globalThis.webpackChunkdev_tips||[]).push([[3992],{2559:(t,e,r)=>{r.r(e),r.d(e,{assets:()=>a,contentTitle:()=>T,default:()=>l,frontMatter:()=>s,metadata:()=>n,toc:()=>N});const n=JSON.parse('{"id":"H2WM/SQL/M3-demo","title":"M3-demo","description":"","source":"@site/docs/H2WM/SQL/M3-demo.md","sourceDirName":"H2WM/SQL","slug":"/H2WM/SQL/M3-demo","permalink":"/dev-tips/docs/H2WM/SQL/M3-demo","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Le langage de requ\xeate SQL avec SQL Server","permalink":"/dev-tips/docs/H2WM/SQL/M3-DDL"},"next":{"title":"Le langage de requ\xeate SQL avec SQL Server","permalink":"/dev-tips/docs/H2WM/SQL/M4-DML"}}');var i=r(4848),E=r(8453);const s={sidebar_position:4},T=void 0,a={},N=[];function A(t){const e={code:"code",pre:"pre",...(0,E.R)(),...t.components};return(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-SQL",children:"CREATE TABLE Clients(\r\n\tid_cli\t\tNUMERIC(6)\t\t\t\t\tCONSTRAINT PK_clients PRIMARY KEY,\r\n\tnom\t\t\tVARCHAR(30)\t\tNOT NULL,\r\n\tprenom\t\tVARCHAR(30)\t\tNULL,\r\n\tadresse\t\tVARCHAR(120)\tNULL,\r\n\tcpo\t\t\tCHAR(5)\t\t\tNOT NULL\tCONSTRAINT CK_clients_cpo CHECK(cpo BETWEEN 1000 AND 95999), -- convertion implicite de Char en int\r\n\tville\t\tVARCHAR(80)\t\tNOT NULL\tCONSTRAINT DF_clients_ville DEFAULT 'Nantes'\r\n);\r\n\r\nCREATE TABLE Fiches(\r\n\tid_fic\t\tNUMERIC(6)\t\tIDENTITY(1001,1)\r\n\t\t\t\t\t\t\t\t\t\t\tCONSTRAINT PK_fiches PRIMARY KEY,\r\n\tid_cli\t\tNUMERIC(6)\t\tNULL,\r\n\tdate_crea\tDATETIME2\t\tNOT NULL\tCONSTRAINT DF_fiches_dateCrea DEFAULT GETDATE(),\r\n\tdate_paye\tDATETIME2\t\tNULL,\r\n\tetat\t\tCHAR(2)\t\t\tNOT NULL\tCONSTRAINT CK_fiches_etat CHECK(etat IN('EC', 'RE', 'SO')) \r\n\t\t\t\t\t\t\t\t\t\t\tCONSTRAINT DF_fiches_etat DEFAULT 'EC',\r\n-- on accepte qu'il n'y ai pas de date de paiement sinon elle doit \xeatre supp\xe9rieur \xe0 la date de creation\r\n\t-- CONTRAINTE QUI PORTE SUR 2 COLONNES DONC DOIT ETRE DECLARER EN CONTRAINTE DE TABLE\r\n\tCONSTRAINT CK_Fiches_dateCreaEtat CHECK ((date_paye IS NOT NULL AND etat = 'SO' AND date_paye > date_crea) OR (date_paye IS NULL AND etat <> 'SO'))\r\n);\r\n\r\nCREATE TABLE Modeles(\r\n\tid_modele\tINT\t\t\t\tIDENTITY\tCONSTRAINT PK_modeles PRIMARY KEY,\r\n\tdesignation\tVARCHAR(80)\t\tNOT NULL,\r\n\tid_gam\t\tCHAR(2)\t\t\tNOT NULL,\r\n\tid_cate\t\tCHAR(4)\t\t\tNOT NULL\r\n);\r\n\r\nCREATE TABLE Articles(\r\n\tref_art\t\tCHAR(3)\t\t\t\t\t\tCONSTRAINT PK_articles PRIMARY KEY,\r\n\tid_modele\tINT\t\t\t\tNOT NULL\r\n);\r\n\r\nCREATE TABLE Lignes_fic(\r\n\tid_fic\t\tNUMERIC(6),\r\n\tno_lig\t\tNUMERIC(2),\r\n\tref_art\t\tCHAR(3)\t\t\tNOT NULL,\r\n\tdate_depart\tDATETIME2\t\tNOT NULL\tCONSTRAINT DF_lignesFic_depart DEFAULT GETDATE(),\r\n\tdate_retour\tDATETIME2\t\tNULL,\r\n\tCONSTRAINT PK_lignesFic PRIMARY KEY(id_fic, no_lig),\r\n\tCONSTRAINT CK_LignesFic_dates CHECK (date_retour IS NULL OR date_retour > date_depart)\r\n);\r\n\r\nCREATE TABLE Gammes(\r\n\tid_gam\t\tCHAR(2)\t\t\t\t\t\tCONSTRAINT PK_gammes PRIMARY KEY,\r\n\tlibelle\t\tVARCHAR(30)\t\tNOT NULL\tCONSTRAINT UN_gammes_libelle UNIQUE\r\n);\r\n\r\nCREATE TABLE Categories(\r\n\tid_cate\tCHAR(4)\t\t\t\t\t\tCONSTRAINT PK_categories PRIMARY KEY,\r\n\tlibelle\t\tVARCHAR(30)\t\tNOT NULL\tCONSTRAINT UN_categories_libelle UNIQUE\r\n);\r\n\r\nCREATE TABLE Grille_tarifs(\r\n\tid_gam\t\tCHAR(2),\r\n\tid_cate\t\tCHAR(4),\r\n\tprix_jour\tNUMERIC(5,2)\tNOT NULL CONSTRAINT CK_GrilleTarif_prixJour CHECK (prix_jour > 0),\r\n\tCONSTRAINT PK_GrilleTarif_idGamIdCate PRIMARY KEY(id_gam, id_cate)\r\n\r\n);\r\n\r\n\r\n\r\n/****************************************************************************/\r\n/*\tSCRIPT DE CREATION DES TABLES DE LA BASE DE DONNEES Locations\t\t\t*/\r\n/*\tAuteur : ENI Ecole\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\r\n/*\tDate de cr\xe9ation :\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\r\n/*\tVersion : 1.0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\r\n/*\tObjectif : Creation des contraintes d'int\xe9grit\xe9 r\xe9f\xe9rentielle et des\t*/\r\n/*\tindex\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\t\t\r\n/*\tModifications :\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\r\n/*\t- ajout d\u2019un index sur le nom et le prenom d'un client etendu \xe0 la\t\t*/\r\n/*\tville, pour acc\xe9l\xe9rer les recherches et les tris\t\t\t\t\t\t*/\r\n/****************************************************************************/\r\n\r\n-- 3. Creation des contrantes d'int\xe9grit\xe9 r\xe9f\xe9rentielle\r\nALTER TABLE Fiches\r\n\tADD CONSTRAINT FK_Fiches_Clients FOREIGN KEY (id_cli) REFERENCES Clients(id_cli)\r\n\tON DELETE SET NULL; -- tp mod3 / Attendu 2 / rond blanc 2 / tiret 1\r\n\r\nALTER TABLE Articles\r\n\tADD CONSTRAINT FK_Articles_Modeles FOREIGN KEY (id_modele) REFERENCES Modeles(id_modele);\r\n\r\nALTER TABLE Lignes_fic\r\n\tADD CONSTRAINT FK_LignesFic_Fiches FOREIGN KEY (id_fic) REFERENCES Fiches(id_fic)\r\n\tON DELETE CASCADE;-- tp mod3 / Attendu 2 / rond blanc 2 / tiret 2,\r\n\t--CONSTRAINT FK_LignesFic_Articles FOREIGN KEY (ref_art) REFERENCES Articles(ref_art);\r\n\r\nALTER TABLE Lignes_fic\r\n\tADD CONSTRAINT FK_LignesFic_Articles FOREIGN KEY (ref_art) REFERENCES Articles(ref_art)\r\n\tON UPDATE CASCADE; -- tp mod3 / Attendu 2 / rond blanc 2 / tiret 3\r\n\r\nALTER TABLE Modeles\r\n-- cl\xe9 primaire \xe0 2 colonnes donc appeler les deux dans les parenth\xe8ses\r\n\tADD CONSTRAINT FK_Modeles_GrilleTarifs FOREIGN KEY(id_gam, id_cate) REFERENCES Grille_tarifs(id_gam, id_cate);\r\n\r\nALTER TABLE Grille_tarifs\r\n\tADD CONSTRAINT FK_GrilleTarifs_Gammes FOREIGN KEY(id_gam) REFERENCES Gammes(id_gam),\r\n\tCONSTRAINT FK_GrilleTarifs_Categories FOREIGN KEY(id_cate) REFERENCES Categories(id_cate); \r\n\r\n\r\n-- 4.\tL\u2019ajout d\u2019index pour acc\xe9l\xe9rer les jointures\r\nCREATE INDEX FK_Fiches_Clients ON Fiches(id_cli);\r\nCREATE INDEX FK_LignesFic_Articles ON Lignes_fic(ref_art);\r\nCREATE INDEX FK_LignesFic_Fiches ON Lignes_fic(id_fic);\r\nCREATE INDEX FK_Articles_Modeles ON Articles(id_modele);\r\n\r\nCREATE INDEX FK_Modeles_GrilleTarifs ON Modeles(id_gam, id_cate);\r\nCREATE INDEX FK_GrilleTarifs_Gammes ON Grille_tarifs(id_gam);\r\nCREATE INDEX FK_GrilleTarifs_Categories ON Grille_tarifs(id_cate);\r\n\r\n\r\n\r\n/****************************************************************************/\r\n/*\tSCRIPT DE SUPPRESSION DES TABLES DE LA BASE DE DONNEES Locations\t\t*/\r\n/*\tAuteur : ENI Ecole\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\r\n/*\tDate de cr\xe9ation :\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\r\n/*\tVersion : 1.0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\r\n/*\tObjectif : Suppression des contraintes d'int\xe9grit\xe9 r\xe9f\xe9rentielle puis\t*/\r\n/*\tdes tables\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\t\t\r\n/*\tModifications :\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*/\r\n/****************************************************************************/\r\n\r\nALTER TABLE Fiches DROP CONSTRAINT FK_Fiches_Clients;\r\nALTER TABLE Lignes_fic DROP CONSTRAINT FK_LignesFic_Articles;\r\nALTER TABLE Lignes_fic DROP CONSTRAINT FK_LignesFic_Fiches;\r\nALTER TABLE Articles DROP CONSTRAINT FK_Articles_Modeles;\r\n\r\nALTER TABLE Modeles DROP CONSTRAINT FK_Modeles_GrilleTarifs;\r\nALTER TABLE Grille_tarifs DROP CONSTRAINT FK_GrilleTarifs_Gammes, FK_GrilleTarifs_Categories;\r\n--ALTER TABLE Grille_tarifs DROP CONSTRAINT FK_GrilleTarifs_Categories;\r\n\r\nDROP TABLE Lignes_fic, Fiches, Clients, Articles, Modeles, Grille_tarifs, Categories, Gammes;\r\n\n"})})}function l(t={}){const{wrapper:e}={...(0,E.R)(),...t.components};return e?(0,i.jsx)(e,{...t,children:(0,i.jsx)(A,{...t})}):A(t)}},8453:(t,e,r)=>{r.d(e,{R:()=>s,x:()=>T});var n=r(6540);const i={},E=n.createContext(i);function s(t){const e=n.useContext(E);return n.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function T(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:s(t.components),n.createElement(E.Provider,{value:e},t.children)}}}]);